(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{430:function(e,n,d){"use strict";d.r(n);var t=d(2),o=Object(t.a)({},(function(){var e=this,n=e._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"ç®€ä»‹"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ç®€ä»‹"}},[e._v("#")]),e._v(" ç®€ä»‹")]),e._v(" "),n("p",[e._v("ç”±äºæœ€è¿‘å·¥ä½œç”¨vue2æ¡†æ¶æ¯”è¾ƒå¤šï¼Œå„ç§ç”¨æ³•æ“ä½œè¶Šæ¥è¶Šç†Ÿç»ƒï¼Œä½†æ˜¯å†ç†Ÿç»ƒä¹Ÿåªæ˜¯ç†Ÿç»ƒå·¥ï¼ŒæŒæ¡å†…éƒ¨åŸç†æ‰æ˜¯å·¥ç¨‹å¸ˆåº”è¯¥æœ‰çš„æ°´å‡†ã€‚")]),e._v(" "),n("h2",{attrs:{id:"ä¸ºä»€ä¹ˆä¼šç”¨åˆ°diffç®—æ³•"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆä¼šç”¨åˆ°diffç®—æ³•"}},[e._v("#")]),e._v(" ä¸ºä»€ä¹ˆä¼šç”¨åˆ°diffç®—æ³•")]),e._v(" "),n("p",[e._v("é¦–å…ˆç”±ä¹‹å‰æˆ‘çœ‹åˆ°çš„vue2æºç çŸ¥é“ï¼Œvue2æ˜¯æŠŠæ¨¡æ¿ç¿»è¯‘ä¸ºäº†renderå‡½æ•°ï¼Œè€Œrenderå‡½æ•°å¯ä»¥ç”ŸæˆVnodeä¹Ÿå°±æ˜¯è™šæ‹Ÿdomï¼Œç„¶åé€šè¿‡update(render())ç”ŸæˆçœŸå®çš„domï¼Œæ‰€ä»¥å†è¿›å…¥updateé‡Œé¢ï¼Œå‘ç°updateä½äºlifecycleæ–‡ä»¶é‡Œé¢ï¼Œåœ¨lifecycleæ–‡ä»¶é‡Œé¢ä¼šå¯¹updateæ··å…¥vueåŸå‹å¯¹è±¡ï¼Œç„¶åå‘ç°é‡Œé¢çš„æ ¸å¿ƒä»£ç å…¶å®æ˜¯è¿™ä¸ª")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("if (!prevVnode) {\n    // è€ VNode ä¸å­˜åœ¨ï¼Œè¡¨ç¤ºé¦–æ¬¡æ¸²æŸ“ï¼Œå³åˆå§‹åŒ–é¡µé¢æ—¶èµ°è¿™é‡Œ\n    vm.$el = vm.__patch__(vm.$el, vnode, hydrating, false /* removeOnly */)\n} else {\n    // å“åº”å¼æ•°æ®æ›´æ–°æ—¶ï¼Œå³æ›´æ–°é¡µé¢æ—¶èµ°è¿™é‡Œ\n    vm.$el = vm.__patch__(prevVnode, vnode)\n}\n")])])]),n("p",[e._v("é‚£ä¹ˆç»§ç»­ç‚¹å‡»__patch__å‘ç°ç‚¹ä¸åŠ¨å› ä¸º__patch__æ˜¯è¢«æŒ‚è½½åˆ°vueåŸå‹å¯¹è±¡ä¸Šçš„ï¼ŒæŸ¥é˜…åå‘ç°å› ä¸ºvueçš„èŠ‚ç‚¹æ›´æ–°æ˜¯æ ¹æ®ä¸åŒå¹³å°æ¥çš„ï¼Œæ‰€ä»¥å®ƒåœ¨platforms/web/runtime/indexä¸­è¢«æŒ‚è½½åˆ°åŸå‹å¯¹è±¡ä¸Šï¼Œå†è¿½ä¸‹å»å‘ç°ä»–åœ¨patchæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªæ“ä½œï¼Œ\n"),n("code",[e._v("export const patch: Function = createPatchFunction({ nodeOps, modules })")]),e._v("\nè¿™å¥ä»£ç è¿ç”¨åˆ°äº†é«˜é˜¶å‡½æ•°ï¼ŒcreatePatchFunctionç‚¹è¿›å»åå‘ç°å®ƒä¼šåœ¨å†…éƒ¨åšä¸€äº›æ“ä½œï¼Œç„¶åè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å‚æ•°æ¥å—ä¸¤ä¸ªä¸€ä¸ªæ˜¯æ—§çš„vnodeä¸€ä¸ªæ˜¯æ–°çš„vnodeï¼Œä½†æ˜¯å¯¹äºå¤–éƒ¨å¤–éƒ¨å¹¶ä¸çŸ¥é“ä¸­é—´è¿˜æœ‰åŠ äº†ä¸€éƒ¨å¤„ç†çš„è¿™ä¸ªæ“ä½œï¼Œè¿™ä¸­é«˜é˜¶å‡½æ•°çš„æ“ä½œæˆ‘è§‰å¾—æœ‰å¿…è¦å­¦ä¼šåº”ç”¨ã€‚"),n("br"),e._v("\nç‚¹è¿›å»åå‘ç°è¿™ä¸ªå‡½æ•°éå¸¸çš„å¤§å¹¶ä¸”å†…éƒ¨åšäº†å¾ˆå¤šçš„æ“ä½œï¼Œ(è¿™æ˜¯åœ¨å‡½æ•°å†…éƒ¨åˆ›å»ºäº†å¾ˆå¤šå‡½æ•°ï¼Œæœ€åè¿”å›å‡½æ•°å’Œä¹‹å‰çœ‹çš„å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³ä¸è°‹è€Œåˆï¼Œè€Œä¸”è¿™ç§æ€è·¯å¾ˆé€‚åˆç±»ä¼¼JSXè¯­æ³•çš„vue3ç»„åˆå¼api)"),n("br"),e._v("\nç›´æ¥çœ‹è¿”å›çš„patchå‡½æ•°ï¼Œåœ¨patchå‡½æ•°ä¸­æœ‰è¿™æ ·ä¸€æ®µä»£ç ")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("if (!isRealElement && sameVnode(oldVnode, vnode)) {\n    // ä¸æ˜¯çœŸå®å…ƒç´ ï¼Œä½†æ˜¯è€èŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™æ˜¯æ›´æ–°é˜¶æ®µï¼Œæ‰§è¡Œ patch æ›´æ–°èŠ‚ç‚¹\n    patchVnode(oldVnode, vnode, insertedVnodeQueue, null, null, removeOnly)\n}\n\n...\nfunction sameVnode (a, b) {\n  return (\n    // key å¿…é¡»ç›¸åŒï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ undefined === undefined => true\n    a.key === b.key && (\n      (\n        // æ ‡ç­¾ç›¸åŒ\n        a.tag === b.tag &&\n        // éƒ½æ˜¯æ³¨é‡ŠèŠ‚ç‚¹\n        a.isComment === b.isComment &&\n        // éƒ½æœ‰ data å±æ€§\n        isDef(a.data) === isDef(b.data) &&\n        // input æ ‡ç­¾çš„æƒ…å†µ\n        sameInputType(a, b)\n      ) || (\n        // å¼‚æ­¥å ä½ç¬¦èŠ‚ç‚¹\n        isTrue(a.isAsyncPlaceholder) &&\n        a.asyncFactory === b.asyncFactory &&\n        isUndef(b.asyncFactory.error)\n      )\n    )\n  )\n}\n\n")])])]),n("p",[e._v("samenodeæ˜¯æ¯”è¾ƒåŒkeyï¼ŒåŒtagï¼ŒåŒæœ‰dataå€¼(è‡³äºä¸ºä»€ä¹ˆåªçœ‹æœ‰æ²¡æœ‰è€Œä¸çœ‹ä¸€ä¸ä¸€æ ·ä¸€ä¼šå°±çŸ¥é“)ï¼Œç„¶åå¦‚æœæ˜¯ä¸€æ ·çš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ‰§è¡ŒpatchVnodeæ–¹æ³•ä¼ è¿›å»æ–°æ—§èŠ‚ç‚¹ã€‚ğŸ˜®ç­‰ç­‰ã€‚ã€‚ã€‚æ¯”è¾ƒä¸åŒï¼Œ"),n("s",[e._v("è¿™éš¾é“å°±æ˜¯ä¼ è¯´ä¸­çš„diffå—")]),e._v("æ²¡é”™ï¼Œdiffå°±æ˜¯è¿™æ ·æ¥çš„ã€‚")]),e._v(" "),n("h2",{attrs:{id:"diffå…·ä½“åšäº†ä»€ä¹ˆ"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diffå…·ä½“åšäº†ä»€ä¹ˆ"}},[e._v("#")]),e._v(" diffå…·ä½“åšäº†ä»€ä¹ˆ")]),e._v(" "),n("p",[e._v("æˆ‘ä»¬ç»§ç»­ç‚¹å‡»patchVnodeæ–¹æ³•ï¼Œæˆ‘ä»¬å…ˆä¸å…³æ³¨å…¶å®ƒçš„ä¸œè¥¿ï¼Œå…ˆçœ‹è¿™ä¸€å¥")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("if (isDef(oldCh) && isDef(ch)) {\n    // å¦‚æœæ–°è€èŠ‚ç‚¹éƒ½æœ‰å­©å­ï¼Œåˆ™é€’å½’æ‰§è¡Œ diff è¿‡ç¨‹\n    if (oldCh !== ch) updateChildren(elm, oldCh, ch, insertedVnodeQueue, removeOnly)\n} \n")])])]),n("p",[e._v("è¿™æ˜¯ä¸€å¥å¾ˆæ˜æ˜¾çš„é€’å½’ï¼Œç»§ç»­ç‚¹å‡»updateChildrenå‡½æ•°å‘ç°")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("    è€èŠ‚ç‚¹çš„å¼€å§‹ç´¢å¼•\n    let oldStartIdx = 0\n    // æ–°èŠ‚ç‚¹çš„å¼€å§‹ç´¢å¼•\n    let newStartIdx = 0\n    // è€èŠ‚ç‚¹çš„ç»“æŸç´¢å¼•\n    let oldEndIdx = oldCh.length - 1\n    // ç¬¬ä¸€ä¸ªè€èŠ‚ç‚¹\n    let oldStartVnode = oldCh[0]\n    // æœ€åä¸€ä¸ªè€èŠ‚ç‚¹\n    let oldEndVnode = oldCh[oldEndIdx]\n    // æ–°èŠ‚ç‚¹çš„ç»“æŸç´¢å¼•\n    let newEndIdx = newCh.length - 1\n    // ç¬¬ä¸€ä¸ªæ–°èŠ‚ç‚¹\n    let newStartVnode = newCh[0]\n    // æœ€åä¸€ä¸ªæ–°èŠ‚ç‚¹\n    let newEndVnode = newCh[newEndIdx]\n")])])]),n("p",[e._v("è¿™ä¸å°±æ˜¯ä¹‹å‰æˆ‘ä»¬æ²¡çœ‹è¿‡vue2æºç çš„æ—¶å€™æ­»è®°ç¡¬èƒŒçš„é‚£ä¸ªvue2diffç®—æ³•çš„åŒç«¯é˜Ÿåˆ—å—ï¼Œæˆ‘ä»¬èµ¶ç´§çœ‹çœ‹å®ƒæ¥ä¸‹æ¥çš„æ“ä½œã€‚")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("    while (oldStartIdx <= oldEndIdx && newStartIdx <= newEndIdx) {\n      if (isUndef(oldStartVnode)) {\n        // å¦‚æœèŠ‚ç‚¹è¢«ç§»åŠ¨ï¼Œåœ¨å½“å‰ç´¢å¼•ä¸Šå¯èƒ½ä¸å­˜åœ¨ï¼Œæ£€æµ‹è¿™ç§æƒ…å†µï¼Œå¦‚æœèŠ‚ç‚¹ä¸å­˜åœ¨åˆ™è°ƒæ•´ç´¢å¼•\n        oldStartVnode = oldCh[++oldStartIdx] // Vnode has been moved left\n      } else if (isUndef(oldEndVnode)) {\n        oldEndVnode = oldCh[--oldEndIdx]\n      } else if (sameVnode(oldStartVnode, newStartVnode)) {\n        // è€å¼€å§‹èŠ‚ç‚¹å’Œæ–°å¼€å§‹èŠ‚ç‚¹æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰§è¡Œ patch\n        patchVnode(oldStartVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)\n        // patch ç»“æŸåè€å¼€å§‹å’Œæ–°å¼€å§‹çš„ç´¢å¼•åˆ†åˆ«åŠ  1\n        oldStartVnode = oldCh[++oldStartIdx]\n        newStartVnode = newCh[++newStartIdx]\n      } else if (sameVnode(oldEndVnode, newEndVnode)) {\n        // è€ç»“æŸå’Œæ–°ç»“æŸæ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰§è¡Œ patch\n        patchVnode(oldEndVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)\n        // patch ç»“æŸåè€ç»“æŸå’Œæ–°ç»“æŸçš„ç´¢å¼•åˆ†åˆ«å‡ 1\n        oldEndVnode = oldCh[--oldEndIdx]\n        newEndVnode = newCh[--newEndIdx]\n      } else if (sameVnode(oldStartVnode, newEndVnode)) { // Vnode moved right\n        // è€å¼€å§‹å’Œæ–°ç»“æŸæ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰§è¡Œ patch\n        patchVnode(oldStartVnode, newEndVnode, insertedVnodeQueue, newCh, newEndIdx)\n        // å¤„ç†è¢« transtion-group åŒ…è£¹çš„ç»„ä»¶æ—¶ä½¿ç”¨\n        canMove && nodeOps.insertBefore(parentElm, oldStartVnode.elm, nodeOps.nextSibling(oldEndVnode.elm))\n        // patch ç»“æŸåè€å¼€å§‹ç´¢å¼•åŠ  1ï¼Œæ–°ç»“æŸç´¢å¼•å‡ 1\n        oldStartVnode = oldCh[++oldStartIdx]\n        newEndVnode = newCh[--newEndIdx]\n      } else if (sameVnode(oldEndVnode, newStartVnode)) { // Vnode moved left\n        // è€ç»“æŸå’Œæ–°å¼€å§‹æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰§è¡Œ patch\n        patchVnode(oldEndVnode, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)\n        canMove && nodeOps.insertBefore(parentElm, oldEndVnode.elm, oldStartVnode.elm)\n        // patch ç»“æŸåï¼Œè€ç»“æŸçš„ç´¢å¼•å‡ 1ï¼Œæ–°å¼€å§‹çš„ç´¢å¼•åŠ  1\n        oldEndVnode = oldCh[--oldEndIdx]\n        newStartVnode = newCh[++newStartIdx]\n      } else {\n        // å¦‚æœä¸Šé¢çš„å››ç§å‡è®¾éƒ½ä¸æˆç«‹ï¼Œåˆ™é€šè¿‡éå†æ‰¾åˆ°æ–°å¼€å§‹èŠ‚ç‚¹åœ¨è€èŠ‚ç‚¹ä¸­çš„ä½ç½®ç´¢å¼•\n\n        // æ‰¾åˆ°è€èŠ‚ç‚¹ä¸­æ¯ä¸ªèŠ‚ç‚¹ key å’Œ ç´¢å¼•ä¹‹é—´çš„å…³ç³»æ˜ å°„ => oldKeyToIdx = { key1: idx1, ... }\n        if (isUndef(oldKeyToIdx)) oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx)\n        // åœ¨æ˜ å°„ä¸­æ‰¾åˆ°æ–°å¼€å§‹èŠ‚ç‚¹åœ¨è€èŠ‚ç‚¹ä¸­çš„ä½ç½®ç´¢å¼•\n        idxInOld = isDef(newStartVnode.key)\n          ? oldKeyToIdx[newStartVnode.key]\n          : findIdxInOld(newStartVnode, oldCh, oldStartIdx, oldEndIdx)\n        if (isUndef(idxInOld)) { // New element\n          // åœ¨è€èŠ‚ç‚¹ä¸­æ²¡æ‰¾åˆ°æ–°å¼€å§‹èŠ‚ç‚¹ï¼Œåˆ™è¯´æ˜æ˜¯æ–°åˆ›å»ºçš„å…ƒç´ ï¼Œæ‰§è¡Œåˆ›å»º\n          createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx)\n        } else {\n          // åœ¨è€èŠ‚ç‚¹ä¸­æ‰¾åˆ°æ–°å¼€å§‹èŠ‚ç‚¹äº†\n          vnodeToMove = oldCh[idxInOld]\n          if (sameVnode(vnodeToMove, newStartVnode)) {\n            // å¦‚æœè¿™ä¸¤ä¸ªèŠ‚ç‚¹æ˜¯åŒä¸€ä¸ªï¼Œåˆ™æ‰§è¡Œ patch\n            patchVnode(vnodeToMove, newStartVnode, insertedVnodeQueue, newCh, newStartIdx)\n            // patch ç»“æŸåå°†è¯¥è€èŠ‚ç‚¹ç½®ä¸º undefined\n            oldCh[idxInOld] = undefined\n            canMove && nodeOps.insertBefore(parentElm, vnodeToMove.elm, oldStartVnode.elm)\n          } else {\n            // æœ€åè¿™ç§æƒ…å†µæ˜¯ï¼Œæ‰¾åˆ°èŠ‚ç‚¹äº†ï¼Œä½†æ˜¯å‘ç°ä¸¤ä¸ªèŠ‚ç‚¹ä¸æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™è§†ä¸ºæ–°å…ƒç´ ï¼Œæ‰§è¡Œåˆ›å»º\n            createElm(newStartVnode, insertedVnodeQueue, parentElm, oldStartVnode.elm, false, newCh, newStartIdx)\n          }\n        }\n        // è€èŠ‚ç‚¹å‘åç§»åŠ¨ä¸€ä¸ª\n        newStartVnode = newCh[++newStartIdx]\n      }\n    }\n")])])]),n("p",[e._v("æ‰€ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µ:"),n("br"),e._v("\n1.å½“å‰oldstartæŒ‡å‘çš„èŠ‚ç‚¹æ˜¯ç©ºçš„ï¼Œå°±è®©oldstartçš„èŠ‚ç‚¹ç´¢å¼•å‘å³ç§»åŠ¨ä¸€ä½"),n("br"),e._v("\n2.å½“å‰oldendæŒ‡å‘çš„èŠ‚ç‚¹ä¸ºç©ºï¼Œå°±è®©oldendçš„èŠ‚ç‚¹ç´¢å¼•å·¦ç§»ä¸€ä½"),n("br"),e._v("\n3.å¦‚æœè€å¼€å§‹å’Œæ–°å¼€å§‹ä¸€æ ·å°±ç´¢å¼•éƒ½å³ç§»ä¸€ä½"),n("br"),e._v("\n4.å¦‚æœè€ç»“æŸå’Œæ–°ç»“æŸä¸€æ ·å°±ç´¢å¼•å·¦ç§»ä¸€ä½"),n("br"),e._v("\n5.å¦‚æœè€å¼€å§‹å’Œæ–°ç»“æŸä¸€æ ·ï¼Œå°±æŠŠè€å¼€å§‹çš„èŠ‚ç‚¹æ¢åˆ°è€ç»“æŸåé¢ï¼Œå¹¶ä¸”è€å¼€å§‹çš„ç´¢å¼•åŠ ä¸€ï¼Œæ–°ç»“æŸç´¢å¼•å·¦ç§»ä¸€ä½"),n("br"),e._v("\n6.å¦‚æœè€ç»“æŸå’Œæ–°å¼€å§‹ä¸€æ ·ï¼Œå°±æŠŠè€ç»“æŸçš„èŠ‚ç‚¹æ¢åˆ°æ–°å¼€å§‹å‰é¢ï¼Œå¹¶ä¸”è€ç»“æŸçš„ç´¢å¼•å‡ä¸€ï¼Œæ–°å¼€å§‹ç´¢å¼•å³ç§»ä¸€ä½"),n("br"),e._v("\n7.ä»¥ä¸Šå‡ ç§æƒ…å†µéƒ½ä¸ç¬¦åˆå°±ï¼Œå°±éå†æ‰¾åˆ°æ–°å¼€å§‹åœ¨è€å¼€å§‹ç»“æŸä¹‹é—´çš„ä½ç½®ï¼Œå¦‚æœé‚£ä¸ªä½ç½®çš„èŠ‚ç‚¹å’Œæ–°å¼€å§‹æ˜¯ä¸€ä¸ªèŠ‚ç‚¹å°±æŠŠé‚£ä¸ªä½ç½®çš„èŠ‚ç‚¹æ¢åˆ°è€å¼€å§‹å‰é¢ï¼Œå¹¶æŠŠåŸæ¥èŠ‚ç‚¹çš„ç½®ä¸ºç©ºï¼Œç„¶åæ–°å¼€å§‹ç´¢å¼•å³ç§»ä¸€ä½ï¼Œä¸ç„¶å°±æ–°åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åæ–°èŠ‚ç‚¹å³ç§»ä¸€ä½"),n("br"),e._v("\n8.å¦‚æœæ²¡æ‰¾åˆ°å°±è¯´æ˜æ˜¯æ–°çš„èŠ‚ç‚¹ï¼Œç›´æ¥åˆ›å»ºå°±å¥½äº†ã€‚")])])}),[],!1,null,null,null);n.default=o.exports}}]);